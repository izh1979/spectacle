# ##############################################
# Do not Edit! Generated by:
# spectacle version ${metadata.MyVersion}
# ###############################################
#set $str_newline = '\n'
# >> macros
#if $extra.content.has_key("macros") and $extra.content.macros.has_key("main")
$str_newline.join($extra.content.macros.main)
#end if
# << macros
#if $extra.has_key("HasStatic") and $extra.HasStatic
%define keepstatic 1
#set $cfgstatic = ""
#else
#set $cfgstatic = "--disable-static"
#end if
#if $metadata.has_key('Builder')
#set $Builder = $metadata.Builder
#else
## default
#set $Builder = 'make'
#end if

#if $Builder == 'python'
%{!?python_sitearch: %define python_sitearch %(%{__python} -c "from distutils.sysconfig import get_python_lib; print get_python_lib(1)")}
#end if
Name:       ${metadata.Name}
Summary:    ${metadata.Summary}
Version:    ${metadata.Version}
Release:    ${metadata.Release}
#if $metadata.has_key("Epoch")
Epoch:      ${metadata.Epoch}
#set $auto_depend = "%{epoch}:%{version}-%{release}"
#else
#set $auto_depend = "%{version}-%{release}"
#end if
Group:      ${metadata.Group}
License:    ${metadata.License}
#if $metadata.has_key("ExclusiveArch")
ExclusiveArch:  ${metadata.ExclusiveArch}
#end if
#if $metadata.has_key("BuildArch")
BuildArch:  ${metadata.BuildArch}
#end if
#if $metadata.has_key("URL")
URL:        ${metadata.URL}
#end if
## Sources
#if $metadata.has_key("Sources")
#set $idx = 0
#for $source in $metadata.Sources
Source${idx}:    $source
#set $idx = $idx + 1
#end for
#end if
Source100:  ${metadata.Name}.yaml
## Patches
#if $metadata.has_key("Patches")
#set $idx = 0
#for $patch in $metadata.Patches
Patch${idx}:     $patch
#set $idx = $idx + 1
#end for
#end if
#if 'NoAutoReq' in $metadata
AutoReq: 0
#end if
## Requires
#if $Builder == 'perl'
Requires:   perl(:MODULE_COMPAT_%(eval "`%{__perl} -V:version`"; echo \$version))
#end if
#if $metadata.has_key("Requires")
#for $req in $metadata.Requires
Requires:   $req
#end for
#end if
#if $metadata.has_key("RequiresPre")
#for $req in $metadata.RequiresPre
Requires(pre): $req
#end for
#end if
#if $metadata.has_key("RequiresPreUn")
#for $req in $metadata.RequiresPreUn
Requires(preun): $req
#end for
#end if
#if $metadata.has_key("RequiresPost")
#for $req in $metadata.RequiresPost
Requires(post): $req
#end for
#end if
#if $metadata.has_key("RequiresPostUn")
#for $req in $metadata.RequiresPostUn
Requires(postun): $req
#end for
#end if
#if $extra.has_key("Lib") and $extra.Lib
Requires(post):  /sbin/ldconfig
Requires(postun):  /sbin/ldconfig
#end if
#if $extra.has_key("Icon") and $extra.Icon
Requires(post):  /bin/touch
#end if
#if $extra.has_key("Info") and $extra.Info
Requires(post): /sbin/install-info
Requires(postun):  /sbin/install-info
#end if
#if $extra.Service
Requires(post):  /sbin/service
Requires(postun):  /sbin/service
Requires(post):  /sbin/chkconfig
Requires(postun):  /sbin/chkconfig
#end if
#if $extra.Schema
Requires(post): GConf2
Requires(preun): GConf2
Requires(pre): GConf2
#end if
## BuildRequires
#if $metadata.has_key("PkgConfigBR")
#for $br in $metadata.PkgConfigBR
#set $br_comps = $br.split()
#if $len($br_comps) > 1
BuildRequires:  pkgconfig($br_comps[0])$br[$len($br_comps[0]):]
#else
#if 'ix86' in $br_comps[0]
%ifarch %{ix86}
BuildRequires:  pkgconfig($br_comps[0][5:len($br_comps[0])])
%endif
#else
BuildRequires:  pkgconfig($br_comps[0])
#end if
#end if
#end for
#end if
#set $br_locale = ""
#set $br_desktop = True
#if $metadata.has_key("PkgBR")
#for $br in $metadata.PkgBR
#if $br == 'intltool' and not $metadata.has_key("LocaleName") and not $metadata.has_key("NoAutoLocale")
#set $br_locale = $metadata.Name
#end if
#if $br == 'desktop-file-utils'
#set $br_desktop = False
#end if
BuildRequires:  $br
#end for
#end if
#if $extra.Desktop and $br_desktop
BuildRequires: desktop-file-utils
#end if
#if $metadata.has_key("RunFdupes")
BuildRequires:  fdupes
#end if
#if 'NoAutoProv' in $metadata
AutoProv: 0
#end if
## Provides
#if $metadata.has_key("Provides")
#for $prd in $metadata.Provides
Provides:   $prd
#end for
#end if
## Conflicts
#if $metadata.has_key("Conflicts")
#for $cfl in $metadata.Conflicts
Conflicts:   $cfl
#end for
#end if
## Obsoletes
#if $metadata.has_key("Obsoletes")
#for $obs in $metadata.Obsoletes
Obsoletes:   $obs
#end for
#end if

%description
#if $metadata.has_key("Description")
${metadata.Description}
#else
Description: %{summary}
#end if

#if $metadata.has_key("AutoSubPackages")
#for $sp in $metadata.AutoSubPackages
%package $sp
Summary:    Development files for %{name}
Group:      Development/Libraries
Requires:   %{name} = $auto_depend
%description $sp
Development files for %{name}

#end for
#end if

#if $metadata.has_key("SubPackages")
#for $sp in $metadata.SubPackages
#set $sub_extra = $extra.subpkgs[$sp.Name]
#if $sp.has_key("AsWholeName")
%package -n $sp.Name
#else
%package $sp.Name
#end if
Summary:    $sp.Summary
#if $sp.has_key("Group")
Group:      $sp.Group
#else
Group:      ${metadata.Group}
#end if
#if 'NoAutoReq' in $metadata
AutoReq:    0
#end if
#if $sp.has_key("AutoDepend") and not $metadata.has_key("NoFiles")
Requires:   %{name} = $auto_depend
#end if
#if $sp.has_key("Requires")
#for $req in $sp.Requires
Requires:   $req
#end for
#end if
#if $sp.has_key("RequiresPre")
#for $req in $sp.RequiresPre
Requires(pre): $req
#end for
#end if
#if $sp.has_key("RequiresPreUn")
#for $req in $sp.RequiresPreUn
Requires(preun): $req
#end for
#end if
#if $sp.has_key("RequiresPost")
#for $req in $sp.RequiresPost
Requires(post): $req
#end for
#end if
#if $sp.has_key("RequiresPostUn")
#for $req in $sp.RequiresPostUn
Requires(postun): $req
#end for
#end if
#if $sub_extra.has_key("Lib") and $sub_extra.Lib
Requires(post):  /sbin/ldconfig
Requires(postun):  /sbin/ldconfig
#end if
#if $sub_extra.has_key("Icon") and $sub_extra.Icon
Requires(post):  /bin/touch
#end if
#if $sub_extra.has_key("Info") and $sub_extra.Info
Requires(post):  /sbin/install-info
Requires(postun):  /sbin/install-info
#end if
#if $sub_extra.Service
Requires(post):  /sbin/service
Requires(post):  /sbin/chkconfig
Requires(postun): /sbin/service
Requires(postun): /sbin/chkconfig
#end if
## Provides
#if $sp.has_key("Provides")
#for $prd in $sp.Provides
Provides:   $prd
#end for
#end if
## Conflicts
#if $sp.has_key("Conflicts")
#for $cfl in $sp.Conflicts
Conflicts:   $cfl
#end for
#end if
## Obsoletes
#if $sp.has_key("Obsoletes")
#for $obs in $sp.Obsoletes
Obsoletes:   $obs
#end for
#end if

#if $sp.has_key("AsWholeName")
%description -n $sp.Name
#else
%description $sp.Name
#end if
#if $sp.has_key('Description')
$sp.Description
#else
Description: %{summary}
#end if

#end for
#end if

############################ prep scripts
%prep
#if $metadata.has_key("Sources")
#if $metadata.has_key("NoSetup")
# No setup
#else if $metadata.has_key("SetupOptions")
%setup $metadata.SetupOptions
#else
%setup -q -n $metadata.SourcePrefix
#end if

#end if
## Applying patches
#if $metadata.has_key("Patches")
#set $idx = 0
#for $patch in $metadata.Patches
$metadata.PatchCmts[$idx]
#if 'PatchOpts' in $metadata
%patch${idx} $metadata.PatchOpts[$idx]
#else
%patch${idx} -p1
#end if
#set $idx = $idx + 1
#end for
#end if
# >> setup
#if $extra.content.has_key("setup") and $extra.content.setup.has_key("main")
$str_newline.join($extra.content.setup.main)
#end if
# << setup

############################ build scripts
%build
#if not $metadata.has_key('UseAsNeeded')
unset LD_AS_NEEDED
#end if
# >> build pre
#if $extra.content.has_key("build") and $extra.content.build.has_key("pre")
$str_newline.join($extra.content.build.pre)
#end if
# << build pre

############################
#if $Builder == 'python'
CFLAGS="\$RPM_OPT_FLAGS" %{__python} setup.py build
#else if $Builder == 'qmake'
#set $Configure = 'none'
qmake-qt4 install_prefix=/usr
make %{?jobs:-j%jobs}
#else if $Builder == 'perl'
if test -f Makefile.PL; then
%{__perl} Makefile.PL INSTALLDIRS=vendor
make %{?jobs:-j%jobs}
else
%{__perl} Build.PL  --installdirs vendor
./Build
fi
#else
#######
#if $metadata.has_key('Configure')
#set $Configure = $metadata.Configure
#######
#else
## default
#set $Configure = 'configure'
#end if
#######
#if $Configure == 'autogen'
%autogen $cfgstatic#slurp
#else if $Configure == 'configure'
%configure $cfgstatic#slurp
#else if $Configure == 'reconfigure'
%reconfigure $cfgstatic#slurp
#end if
## any other values fall thru to 'noconfigure'
#if ( $Configure != 'noconfigure' or $Configure != 'none' ) and $metadata.has_key("ConfigOptions")
 \
#set $length = len($metadata.ConfigOptions)
#set $idx = 1
#for $opt in $metadata.ConfigOptions
#if 'arm:' in $opt
%ifarch %{arm}
    $opt[4:len($opt)]#slurp
#if $idx == $length

#else
 \
#end if
%endif
#else if 'ix86' in $opt
%ifarch %{ix86}
    $opt[5:len($opt)]#slurp
#if $idx == $length

#else
 \
#end if
%endif
#else
    $opt#slurp
#if $idx == $length

#else
 \
#end if
#end if
#set $idx = $idx + 1
#end for
#end if ## ConfigOptions

#if $Builder == 'make'
make %{?jobs:-j%jobs}
#else if $Builder == 'single-make'
make
#else if $Builder != 'no-make' and $Builder != 'none' and $Builder != 'no-builder'
$Builder
#end if
#end if ## Builder == python
############################

# >> build post
#if $extra.content.has_key("build") and  $extra.content.build.has_key("post")
$str_newline.join($extra.content.build.post)
#end if
# << build post
############################ installation scripts
%install
rm -rf %{buildroot}
# >> install pre
#if $extra.content.has_key("install") and  $extra.content.install.has_key("pre")
$str_newline.join($extra.content.install.pre)
#end if
# << install pre
#if $Builder == 'python'
#if 'SupportOtherDistros' in $metadata
%if 0%{?suse_version}
%{__python} setup.py install --root=%{buildroot} --prefix=%{_prefix}
%else
%{__python} setup.py install --root=%{buildroot} -O1
%endif
#else
%{__python} setup.py install --root=%{buildroot} -O1
#end if
#else if $Builder == 'perl'
if test -f Makefile.PL; then
make pure_install PERL_INSTALL_ROOT=%{buildroot}
else
./Build install --installdirs vendor
fi
find %{buildroot} -type f -name .packlist -exec rm -f {} ';'
find %{buildroot} -depth -type d -exec rmdir {} 2>/dev/null ';'
find %{buildroot} -type f -name '*.bs' -empty -exec rm -f {} ';'
%{_fixperms} %{buildroot}/*
#else if $Builder == 'make' or $Builder == 'single-make' or $Builder == 'qmake'
#if 'SupportOtherDistros' in $metadata
%if 0%{?moblin_version}
%make_install
%else
%makeinstall
%endif
#else
%make_install
#end if
#end if ## of Builder==python
#if $metadata.has_key("ExtraInstall")
$metadata.ExtraInstall
#end if

# >> install post
#if $extra.content.has_key("install") and $extra.content.install.has_key("post")
$str_newline.join($extra.content.install.post)
#end if
# << install post
#if $extra.Desktop
desktop-file-install --delete-original       \
  --dir %{buildroot}%{_datadir}/applications             \
   %{buildroot}%{_datadir}/applications/*
#end if
#if $metadata.has_key("LocaleName")
#if $metadata.has_key("LocaleOptions")
#set $localeopt_str = $metadata["LocaleOptions"]
%find_lang ${metadata.LocaleName} $localeopt_str
#else
%find_lang ${metadata.LocaleName}
#end if
#else if $br_locale != ""
%find_lang $br_locale
#end if
############################ run fdupes
#if $metadata.has_key("RunFdupes")
%fdupes  %{buildroot}/${metadata.RunFdupes}
#end if
############################ optional check scripts
#if $metadata.has_key("Check")
%check
# >> check
#if $extra.content.has_key("check")
$str_newline.join($extra.content.check.main)
#else
#if  $Builder == 'perl'
if test -f Makefile.PL; then
make test
else
./Build test
fi
#else
make check
#end if
#end if
# << check
#end if

############################ Pre
#set $has_extra_pre = $extra.content.has_key("pre") and $extra.content.pre.has_key("main")
#if $extra.Schema or $has_extra_pre
%pre
## -Schema
#if $extra.Schema
if [ "$1" -gt 1 ]; then
#for $schema in $extra.Schemas
  export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
  gconftool-2 --makefile-uninstall-rule \
    $schema \
    > /dev/null || :
#end for
fi
#end if
## -Extra pre
#if $has_extra_pre
# >> pre
$str_newline.join($extra.content.pre.main)
# << pre
#end if
#end if

############################ PreUn
#set $has_extra_preun = $extra.content.has_key("preun") and $extra.content.preun.has_key("main")
#if $extra.Schema or $has_extra_preun
%preun
## -Schema
#if $extra.Schema
if [ "$1" -eq 0 ]; then
#for $schema in $extra.Schemas
  export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
  gconftool-2 --makefile-uninstall-rule \
    $schema \
    > /dev/null || :
#end for
fi
#end if
## -Extra preun
#if $has_extra_preun
# >> preun
$str_newline.join($extra.content.preun.main)
# << preun
#end if
#end if

############################ Post
#set $has_extra_post = $extra.content.has_key("post") and $extra.content.post.has_key("main")
#if $extra.Lib or $extra.Info or $extra.Schema or $extra.Icon or $has_extra_post
#set $only_Lib = not ($extra.Info or $extra.Schema or $extra.Icon or $has_extra_post)
#if $only_Lib
%post -p /sbin/ldconfig
#else
%post
#end if
## -Lib
#if $extra.Lib and not $only_Lib
/sbin/ldconfig
#end if
## -Schema
#if $extra.Schema
#for $schema in $extra.Schemas
export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
gconftool-2 --makefile-install-rule \
    $schema  > /dev/null || :
#end for
#end if
## -Info
#if $extra.Info
#for $inf in $extra.Infos
%install_info --info-dir=%_infodir $inf
#end for
#end if
## -Icon
#if $extra.Icon
/bin/touch --no-create %{_datadir}/icons/hicolor || :
%{_bindir}/gtk-update-icon-cache \
  --quiet %{_datadir}/icons/hicolor 2> /dev/null|| :
#end if
## -Extra Post Script
#if $has_extra_post
# >> post
$str_newline.join($extra.content.post.main)
# << post
#end if
#end if ## need post

############################ PostUn
#set $has_extra_postun = $extra.content.has_key("postun") and $extra.content.postun.has_key("main")
#if $extra.Lib or $extra.Info or $extra.Icon or $has_extra_postun
#set $only_Lib = not ($extra.Info or $extra.Icon or $has_extra_postun)
#if $only_Lib
%postun -p /sbin/ldconfig
#else
%postun
#end if
#if $extra.Lib and not $only_Lib
/sbin/ldconfig
#end if
## -Info
#if $extra.Info
if [ $1 = 0 ] ;then
#for $inf in $extra.Infos
%install_info_delete --info-dir=%{_infodir} $inf
#end for
fi
#end if
## -Icon
#if $extra.Icon
/bin/touch --no-create %{_datadir}/icons/hicolor || :
%{_bindir}/gtk-update-icon-cache \
  --quiet %{_datadir}/icons/hicolor 2> /dev/null|| :
#end if
## -Extra Postun Script
#if $has_extra_postun
# >> postun
$str_newline.join($extra.content.postun.main)
# << postun
#end if
#end if ## need postun

## Post for SubPackages
#if $metadata.has_key("SubPackages")
#for $sp in $metadata.SubPackages
#set $sub_extra = $extra.subpkgs[$sp.Name]
#if $sub_extra.Info or $sub_extra.Lib or $sub_extra.Schema
#set $only_Lib = not ($sub_extra.Info or $sub_extra.Schema)
#if $only_Lib
%post $sp.Name -p /sbin/ldconfig
#else
%post $sp.Name
#end if
## -Lib
#if $sub_extra.Lib and not $only_Lib
/sbin/ldconfig
#end if
## -Schema
#if $sub_extra.Schema
#for $schema in $sub_extra.Schemas
export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
gconftool-2 --makefile-install-rule \
    $schema  > /dev/null || :
#end for
#end if
## -Extra Post Script
### TODO
## -Info
#if $sub_extra.Info
#for $inf in $sub_extra.Infos
%install_info --info-dir=%_infodir $inf
#end for
#end if ## Info
#end if ## need post

## PostUn for SubPackages
#if $sub_extra.Info or $sub_extra.Lib
#set $only_Lib = not $sub_extra.Info
#if $only_Lib
%postun $sp.Name -p /sbin/ldconfig
#else
%postun $sp.Name
#end if
#if $sub_extra.Lib and not $only_Lib
/sbin/ldconfig
#end if
#if $sub_extra.Info
if [ $1 = 0 ] ;then
#for $inf in $sub_extra.Infos
%install_info_delete --info-dir=%{_infodir} $inf
#end for
fi
#end if ## Info
#end if ## need postun
#end for ## per subpackage
#end if ## has subpackages

#if not $metadata.has_key("NoFiles")
#if $metadata.has_key("LocaleName")
%files -f ${metadata.LocaleName}.lang
#else if $br_locale != ""
%files -f ${br_locale}.lang
#else if $metadata.has_key('FilesInput')
%files -f $metadata.FilesInput
#else
%files
#end if
%defattr(-,root,root,-)
## TODO to be cleanup
#if $metadata.has_key("Documents")
#for $doc in $metadata.Documents
%doc $doc
#end for
#end if
#if "Files" in $metadata:
#for $f in $metadata.Files
$f
#end for
#end if
# >> files
#if $extra.content.has_key("files") and $extra.content.files.has_key("main")
$str_newline.join($extra.content.files.main)
#end if
# << files
#end if ## not NoFiles

#if $metadata.has_key("AutoSubPackages")
#for $sp in $metadata.AutoSubPackages
%files $sp
%defattr(-,root,root,-)
# >> files $sp
#if $extra.content.has_key("files") and $extra.content.files.has_key($sp)
$str_newline.join($extra.content.files[$sp])
#end if
# << files $sp

#end for
#end if

#if $metadata.has_key("SubPackages")
#for $sp in $metadata.SubPackages
#if $sp.has_key("AsWholeName")
#set $pkg_name = "-n " + $sp.Name
#else
#set $pkg_name = $sp.Name
#end if
#if $sp.has_key('FilesInput')
%files $pkg_name -f $sp.FilesInput
#else
%files $pkg_name
#end if
%defattr(-,root,root,-)
## TODO to be cleanup
#if $sp.has_key("Documents")
#for $doc in $sp.Documents
%doc $doc
#end for
#end if
#if "Files" in $sp:
#for $f in $sp.Files
$f
#end for
#end if
# >> files $sp.Name
#if $extra.content.has_key("files") and $extra.content.files.has_key($sp.Name)
$str_newline.join($extra.content.files[$sp.Name])
#end if
# << files $sp.Name

#end for
#end if
